<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第7頁 - 關係五部曲紀錄</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        table.rel-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            table-layout: fixed;
        }
        table.rel-table th,
        table.rel-table td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
            overflow: hidden;
        }
        table.rel-table th {
            background: #f0f0f0;
        }
        table.rel-table input, table.rel-table select {
            width: 100%;
            box-sizing: border-box;
            border: none;
            padding: 4px;
        }
        .note {
            font-size: 0.9em;
            background: #fffff5;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <a href="page6.html">上一頁</a>
            <a href="home.html">首頁</a>
            <a href="page8.html">下一頁</a>
        </nav>
        <h2>關係五部曲紀錄</h2>
        <div class="note">★ 關係五部曲：認識、熟悉、喜歡、信任、莫逆</div>
        <table class="rel-table">
            <thead>
                <tr>
                    <th style="width:5%">#</th>
                    <th style="width:18%">日期</th>
                    <th style="width:14%">關係度</th>
                    <th style="width:14%">姓名</th>
                    <th style="width:20%">主要話題</th>
                    <th style="width:14%">跟進次數</th>
                    <th style="width:30%">跟進紀錄</th>
                </tr>
            </thead>
            <tbody id="rel-table-body"></tbody>
        </table>
        <script>
        (function() {
            const tbody = document.getElementById('rel-table-body');
            const relOptions = ['認識','熟悉','喜歡','信任','莫逆'];

            // 生成8行
            for (let i = 1; i <= 8; i++) {
                const tr = document.createElement('tr');

                // 編號
                const numTd = document.createElement('td');
                numTd.textContent = i;
                tr.appendChild(numTd);

                // 日期
                const dateTd = document.createElement('td');
                const dateInput = document.createElement('input');
                dateInput.type = 'date';
                dateInput.dataset.key = `rel_${i}_date`;
                dateTd.appendChild(dateInput);
                tr.appendChild(dateTd);

                // 關係度
                const degTd = document.createElement('td');
                const degSelect = document.createElement('select');
                degSelect.dataset.key = `rel_${i}_degree`;
                relOptions.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt;
                    option.textContent = opt;
                    degSelect.appendChild(option);
                });
                degTd.appendChild(degSelect);
                tr.appendChild(degTd);

                // 姓名
                const nameTd = document.createElement('td');
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.dataset.key = `rel_${i}_name`;
                nameTd.appendChild(nameInput);
                tr.appendChild(nameTd);

                // 主要話題
                const topicTd = document.createElement('td');
                const topicInput = document.createElement('input');
                topicInput.type = 'text';
                topicInput.dataset.key = `rel_${i}_topic`;
                topicTd.appendChild(topicInput);
                tr.appendChild(topicTd);

                // 跟進次數（下拉 1~10）
                const followTd = document.createElement('td');
                const followSelect = document.createElement('select');
                followSelect.dataset.key = `rel_${i}_followCount`;
                for (let n = 1; n <= 10; n++) {
                    const opt = document.createElement('option');
                    opt.value = n;
                    opt.textContent = n;
                    followSelect.appendChild(opt);
                }
                followTd.appendChild(followSelect);
                tr.appendChild(followTd);

                // 跟進紀錄（對應跟進次數）
                const recTd = document.createElement('td');
                const recInput = document.createElement('input');
                recInput.type = 'text';
                recInput.dataset.key = `rel_${i}_record_1`; // 預設存第一次
                recTd.appendChild(recInput);
                tr.appendChild(recTd);

                // 切換跟進次數時更新 dataset.key
                followSelect.addEventListener('change', () => {
                    const n = followSelect.value;
                    recInput.dataset.key = `rel_${i}_record_${n}`;
                    const saved = localStorage.getItem(recInput.dataset.key);
                    recInput.value = saved || '';
                });

                tbody.appendChild(tr);
            }

            // 載入儲存的資料並設置監聽
            const elements = tbody.querySelectorAll('input, select');
            elements.forEach(el => {
                const key = el.dataset.key;
                const saved = localStorage.getItem(key);
                if (saved) {
                    el.value = saved;
                }
                el.addEventListener('change', () => {
                    localStorage.setItem(key, el.value);
                });
                el.addEventListener('input', () => {
                    localStorage.setItem(el.dataset.key, el.value);
                });
            });
        })();
        </script>
    </div>
</body>
</html>